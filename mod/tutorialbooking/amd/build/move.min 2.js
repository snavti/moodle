define(["jquery","core/log","core/notification","core/ajax","core/sortable_list","core/str","core/templates"],function(a,b,c,d,e,f,g){var h,i={DRAGGABLE:".tutorial_session",DRAGAREA:".tutorial_sessions",HANDLEELEMENT:".tutorial_session .sectionname",MOVEDOWNCONTROL:".tutorial_session .controls .movedown",MOVEUPCONTROL:".tutorial_session .controls .moveup"},j=function(){b.debug("Setting up","mod_tutorialbooking/dragdrop"),a(i.MOVEUPCONTROL).remove(),a(i.MOVEDOWNCONTROL).remove(),l();var c=new e(i.DRAGAREA);c.getElementName=k,a(i.DRAGAREA+" "+i.DRAGGABLE).on(e.EVENTS.DRAGSTART,m).on(e.EVENTS.DROP,n),b.debug("Setup completed","mod_tutorialbooking/dragdrop")},k=function(b){return a.Deferred().resolve(b.attr("data-name"))},l=function(){return f.get_string("moveslot","mod_tutorialbooking").then(function(a){return g.render("core/drag_handle",{movetitle:a})}).then(function(b){a(i.HANDLEELEMENT).prepend(a(b))}).fail(c.exception)},m=function(a,c){b.debug("Drag started","mod_tutorialbooking/move"),h=c.sourceList.children()},n=function(e,f){b.debug("Dropped element","mod_tutorialbooking/move");var g=f.targetList.children().index(f.element),j=a(e.target).closest(i.DRAGAREA),k=f.element.attr("id"),l=a(h.get(g)).attr("id"),m={methodname:"mod_tutorialbooking_moveslot",args:{tutorial:o(j),slot:p(k),target:p(l)}},n=d.call([m]);n[0].done(function(a){if(a.success)if("before"===a.where){var c="Slot "+k+" moved before slot"+l;b.debug(c,"mod_tutorialbooking/dragdrop")}else{var d="Slot "+k+" moved after slot"+l;b.debug(d,"mod_tutorialbooking/dragdrop")}}).fail(c.exception)},o=function(b){return a(b).attr("id").substr(9)},p=function(a){return a.substr(5)};return{init:j}});