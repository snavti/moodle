define(["jquery"],function(a){function b(b){var c=a(b).attr("data-rate"),d=a(b),e=a(b).closest("form").find(".cmid_field"),f=e.attr("value");a.post(M.cfg.wwwroot+"/mod/studentquiz/save.php",{save:"rate",cmid:f,questionid:a(b).attr("data-questionid"),sesskey:M.cfg.sesskey,rate:c},function(){var b=d.closest(".rating").children("span");b.removeClass("star"),b.addClass("star-empty"),b.each(function(){a(this).attr("data-rate")<=c&&(a(this).removeClass("star-empty"),a(this).addClass("star"))}),a(".studentquiz_behaviour > .rate > .rate_error").addClass("hide")})}return{initialise:function(c,d){var e=a(".studentquiz_behaviour .rate .rating .rateable");e.off("click").on("click",function(){b(this)}),e.on("keypress",function(a){13!==a.keyCode&&32!==a.keyCode||(a.preventDefault(),b(this))}),a('input[name="next"], input[name="previous"], input[name="finish"]').off("click").on("click",function(){var b=a(this),e=!a('.im-controls input[type="submit"]').length||a('.im-controls input[type="submit"]').filter(function(){return this.name.match(/^q.+-submit$/)}).is(":disabled");if(e){var f=a(".rating span").hasClass("star"),g=a(".studentquiz-comment-container").hasClass("has-comment");return c&&(f||(a(".studentquiz_behaviour > .rate > .rate_error").removeClass("hide"),a(".studentquiz_behaviour .rate .rating .rateable:first-child").focus())),d&&(g||a(".studentquiz_behaviour > .comments .comment-error").removeClass("hide")),!(c&&!f||d&&!g)&&(b.submit(),!0)}return b.submit(),!0})},setFocus:function(){a(document).ready(function(){var b=a("#categoryquestions .iconsort");b&&b.parent().focus()})}}});