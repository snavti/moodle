{"version":3,"sources":["../src/comment_area.js"],"names":["define","$","str","ajax","ModalFactory","Templates","fragment","ModalEvents","t","EMPTY_CONTENT","ROOT_COMMENT_VALUE","GET_ALL_VALUE","TEMPLATE_COMMENTS","TEMPLATE_COMMENT","ACTION_CREATE","ACTION_CREATE_REPLY","ACTION_GET_ALL","ACTION_EXPAND","ACTION_DELETE","ACTION_EDIT","ACTION_LOAD_FRAGMENT_FORM","ACTION_LOAD_FRAGMENT_EDIT_FORM","ACTION_EXPAND_ALL","ACTION_COLLAPSE_ALL","ACTION_RENDER_COMMENT","ACTION_APPEND_COMMENT","ACTION_EDITOR_INIT","ACTION_INIT","ACTION_UPDATE_COMMENT_COUNT","ACTION_CLEAR_FORM","ACTION_SHOW_ERROR","FRAGMENT_FORM_CALLBACK","FRAGMENT_EDIT_FORM_CALLBACK","HAS_COMMENT_CLASS","ATTO_CONTENT_TYPE","HAS_CONTENT","NO_CONTENT","SELECTOR","CONTAINER","EXPAND_ALL","COLLAPSE_ALL","SUBMIT_BUTTON","CONTAINER_REPLIES","COMMENT_REPLIES_CONTAINER","COMMENT_COUNT","COMMENT_TEXT","COMMENT_HISTORY","COMMENT_REPLIES_TEXT","LOADING_ICON","COMMENT_AREA_FORM","FORM_SELECTOR","NO_COMMENT","COLLAPSE_LINK","EXPAND_LINK","COMMENT_ITEM","COMMENT_REPLIES_CONTAINER_TO_ITEM","FRAGMENT_FORM","BTN_DELETE","BTN_REPLY","BTN_DELETE_REPLY","ATTO_EDITOR_WRAP","TEXTAREA","COMMENT_COUNT_NUMBER","COMMENT_COUNT_TEXT","ATTO","CONTENT_WRAP","CONTENT","TOOLBAR","COMMENT_ID","SPAN_COMMENT_ID","TOTAL_REPLY","COMMENT_FILTER","COMMENT_FILTER_HIDE","COMMENT_ERROR","BTN_REPORT","COMMENT_FILTER_ITEM","COMMENT_FILTER_NAME","COMMENT_FILTER_TYPE","BTN_EDIT","BTN_EDIT_REPLY","ATTO_HTML_BUTTON","get","elementSelector","btnExpandAll","btnCollapseAll","addComment","containerSelector","questionId","dialogue","loadingIcon","lastFocusElement","formSelector","contextId","userId","string","deleteDialog","deleteTarget","numberToShow","cmId","countServerData","lastCurrentCount","lastTotal","expand","forceCommenting","canViewDeleted","hasComment","referer","highlight","sortFeature","sortable","workingState","isNoComment","init","params","M","util","js_pending","self","escapeSelector","id","el","find","parseInt","data","count","total","sortfeature","forcecommenting","canviewdeleted","isnocomment","initServerRender","initBindEditor","bindEvents","js_complete","changeWorkingState","each","attrs","replies","comment","deleted","numberofreply","expanded","root","bindCommentEvent","commentcount","updateCommentCount","hide","show","query","window","location","search","substring","getParams","parseQueryString","target","length","scrollToElement","interval","setInterval","bindEditorEvent","clearInterval","click","e","preventDefault","empty","getComments","then","response","countCommentAndReplies","renderComment","fail","err","showError","message","innerHTML","commentCount","deletedComments","totalDelete","addClass","rootId","unique","formData","convertFormToJson","attoWrap","hasClass","prepend","required","replyto","text","format","createComment","setTimeout","trigger","is","convertForTemplate","appendComment","handleFailWhenCreateComment","on","asc","sort","desc","nameSelector","iconSelector","type","orderBy","attr","isCurrent","ascString","descString","not","eachName","eachType","defaultString","removeClass","sortType","setSort","getParamsBeforeCallApi","numbertoshow","promise","call","methodname","args","questionid","cmid","when","error","done","showDialog","title","body","html","create","types","CANCEL","modal","getRoot","hidden","reload","current","s","get_string","noCommentSelector","filter","emptyReplies","checkEmptyElement","comments","render","i","hasOwnProperty","reply","bindReplyEvent","bindDeleteEvent","getFragmentFormReplyEvent","bindExpandEvent","bindCollapseEvent","getFragmentEditFormEvent","replySelector","boolean","visibility","prop","css","getFooter","focus","deleteCommentCount","replyCount","deleteReplyCount","constructor","Array","item","deletedtime","j","expandComment","commentid","itemSelector","key","clone","append","convertedItem","currentDisplayComment","newCount","newTotalCount","replaceWith","shortcontent","single","setHasComment","hascomment","reportlink","buildRefererReportLink","form","name","checked","val","isReply","parent","loadFragmentForm","fragmentForm","cancelbutton","remove","loadFragment","js","replaceNodeContents","textFragmentFormId","bindFragmentFormEvent","formFragmentSelector","appendTo","createReplyComment","fragmentFormCancelEvent","replyContainer","repliesEl","numReply","fragmentFormSelector","first","isEdit","commentSelector","closest","DEFAULT","deletecomment","confirmdeletecomment","footer","deletetext","cancel","deleteComment","success","convertedCommentData","parentSelector","parentCountSelector","countSelector","oldReplies","shown","triggerAttoNoContent","fadeIn","Date","now","textareaSelector","attoEditableId","attoEditable","document","getElementById","attoEditableEle","observation","MutationObserver","mutationsList","forEach","mutation","attributeName","indexOf","trim","triggerAttoHasContent","observe","attributes","childList","subtree","change","children","value","container","hasCommentClass","vars","split","queryString","pair","decodeURIComponent","push","speed","top","offset","animate","scrollTop","link","encodeURIComponent","editorContentWrap","submitBtn","placeholder","inArray","loadFragmentEditForm","bindFragmentEditFormEvent","editCommentEvent","editComment","commentTextSelector","generate"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * Control the element in comment area.\n *\n * @package mod_studentquiz\n * @copyright 2020 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_studentquiz/comment_element\n */\ndefine(['jquery', 'core/str', 'core/ajax', 'core/modal_factory', 'core/templates', 'core/fragment', 'core/modal_events'],\n    function($, str, ajax, ModalFactory, Templates, fragment, ModalEvents) {\n        var t = {\n            EMPTY_CONTENT: ['<br><p><br></p>', '<p><br></p>', '<br>', ''],\n            ROOT_COMMENT_VALUE: 0,\n            GET_ALL_VALUE: 0,\n            TEMPLATE_COMMENTS: 'mod_studentquiz/comments',\n            TEMPLATE_COMMENT: 'mod_studentquiz/comment',\n            ACTION_CREATE: 'mod_studentquiz_create_comment',\n            ACTION_CREATE_REPLY: 'mod_studentquiz_create_reply',\n            ACTION_GET_ALL: 'mod_studentquiz_get_comments',\n            ACTION_EXPAND: 'mod_studentquiz_expand_comment',\n            ACTION_DELETE: 'mod_studentquiz_delete_comment',\n            ACTION_EDIT: 'mod_studentquiz_edit_comment',\n            ACTION_LOAD_FRAGMENT_FORM: 'mod_studentquiz_load_fragment_form',\n            ACTION_LOAD_FRAGMENT_EDIT_FORM: 'mod_studentquiz_load_fragment_edit_form',\n            ACTION_EXPAND_ALL: 'action_expand_all',\n            ACTION_COLLAPSE_ALL: 'action_collapse_all',\n            ACTION_RENDER_COMMENT: 'action_render_comment',\n            ACTION_APPEND_COMMENT: 'action_append_comment',\n            ACTION_EDITOR_INIT: 'action_editor_init',\n            ACTION_INIT: 'action_init',\n            ACTION_UPDATE_COMMENT_COUNT: 'action_update_comment_count',\n            ACTION_CLEAR_FORM: 'action_clear_form',\n            ACTION_SHOW_ERROR: 'action_show_error',\n            FRAGMENT_FORM_CALLBACK: 'commentform',\n            FRAGMENT_EDIT_FORM_CALLBACK: 'commenteditform',\n            HAS_COMMENT_CLASS: 'has-comment',\n            ATTO_CONTENT_TYPE: {\n                HAS_CONTENT: 'has-content',\n                NO_CONTENT: 'no-content'\n            },\n            SELECTOR: {\n                CONTAINER: '.studentquiz-comment-container',\n                EXPAND_ALL: '.studentquiz-comment-expand',\n                COLLAPSE_ALL: '.studentquiz-comment-collapse',\n                SUBMIT_BUTTON: '#id_submitbutton',\n                CONTAINER_REPLIES: '.studentquiz-container-replies',\n                COMMENT_REPLIES_CONTAINER: '.studentquiz-comment-replies',\n                COMMENT_COUNT: '.studentquiz-comment-postcount',\n                COMMENT_TEXT: '.studentquiz-comment-text-inside',\n                COMMENT_HISTORY: '.studentquiz-comment-history',\n                COMMENT_REPLIES_TEXT: '.studentquiz-comment-replies .studentquiz-comment-text .studentquiz-comment-text-inside',\n                LOADING_ICON: '.studentquiz-comment-loading',\n                COMMENT_AREA_FORM: 'div.comment-area-form',\n                FORM_SELECTOR: '.studentquiz-comment-postform > div.comment-area-form',\n                NO_COMMENT: '.no-comment',\n                COLLAPSE_LINK: '.studentquiz-comment-collapselink',\n                EXPAND_LINK: '.studentquiz-comment-expandlink',\n                COMMENT_ITEM: '.studentquiz-comment-item',\n                COMMENT_REPLIES_CONTAINER_TO_ITEM: '.studentquiz-comment-replies .studentquiz-comment-item',\n                FRAGMENT_FORM: '.studentquiz-comment-postfragmentform',\n                BTN_DELETE: '.studentquiz-comment-btndelete',\n                BTN_REPLY: '.studentquiz-comment-btnreply',\n                BTN_DELETE_REPLY: '.studentquiz-comment-btndeletereply',\n                ATTO_EDITOR_WRAP: '.editor_atto_wrap',\n                TEXTAREA: 'textarea[id^=\"id_editor_question_\"]',\n                COMMENT_COUNT_NUMBER: '.studentquiz-comment-count-number',\n                COMMENT_COUNT_TEXT: '.studentquiz-comment-count-text',\n                ATTO: {\n                    CONTENT_WRAP: '.editor_atto_content_wrap',\n                    CONTENT: '.editor_atto_content',\n                    TOOLBAR: '.editor_atto_toolbar'\n                },\n                COMMENT_ID: '#comment_',\n                // Is used when server render. We need to collect some stored data attributes to load events.\n                SPAN_COMMENT_ID: '#c',\n                TOTAL_REPLY: '.studentquiz-comment-totalreply',\n                COMMENT_FILTER: '.studentquiz-comment-filter',\n                COMMENT_FILTER_HIDE: '.hide-comment-filter',\n                COMMENT_ERROR: '.studentquiz-comment-container .comment-error',\n                BTN_REPORT: '.studentquiz-comment-btnreport',\n                COMMENT_FILTER_ITEM: '.studentquiz-comment-filter-item',\n                COMMENT_FILTER_NAME: '.studentquiz-comment-filter-name',\n                COMMENT_FILTER_TYPE: '.studentquiz-comment-filter-type',\n                BTN_EDIT: '.studentquiz-comment-btnedit',\n                BTN_EDIT_REPLY: '.studentquiz-comment-btneditreply',\n                ATTO_HTML_BUTTON: 'button.atto_html_button'\n            },\n            get: function() {\n                return {\n                    elementSelector: null,\n                    btnExpandAll: null,\n                    btnCollapseAll: null,\n                    addComment: null,\n                    containerSelector: null,\n                    questionId: null,\n                    dialogue: null,\n                    loadingIcon: null,\n                    lastFocusElement: null,\n                    formSelector: null,\n                    contextId: null,\n                    userId: null,\n                    string: {},\n                    deleteDialog: null,\n                    deleteTarget: null,\n                    numberToShow: 5,\n                    cmId: null,\n                    countServerData: [],\n                    lastCurrentCount: 0,\n                    lastTotal: 0,\n                    expand: false,\n                    forceCommenting: false,\n                    canViewDeleted: false,\n                    hasComment: false,\n                    referer: null,\n                    highlight: 0,\n                    sortFeature: null,\n                    sortable: [],\n                    workingState: false,\n                    isNoComment: false,\n\n                    /**\n                     * Init function.\n                     *\n                     * @param {Object} params\n                     */\n                    init: function(params) {\n                        M.util.js_pending(t.ACTION_INIT);\n                        var self = this;\n                        // Assign attribute.\n                        self.elementSelector = $('#' + $.escapeSelector(params.id));\n                        var el = self.elementSelector;\n\n                        self.btnExpandAll = el.find(t.SELECTOR.EXPAND_ALL);\n                        self.btnCollapseAll = el.find(t.SELECTOR.COLLAPSE_ALL);\n                        self.addComment = el.find(t.SELECTOR.SUBMIT_BUTTON);\n                        self.containerSelector = el.find(t.SELECTOR.CONTAINER_REPLIES);\n                        self.loadingIcon = el.find(t.SELECTOR.LOADING_ICON);\n                        self.formSelector = el.find(t.SELECTOR.FORM_SELECTOR);\n\n                        self.questionId = parseInt(el.data('questionid'));\n                        self.contextId = parseInt(el.data('contextid'));\n                        self.userId = parseInt(el.data('userid'));\n                        self.numberToShow = parseInt(el.data('numbertoshow'));\n                        self.cmId = parseInt(el.data('cmid'));\n\n                        self.countServerData = {\n                            count: params.count,\n                            total: params.total\n                        };\n\n                        self.expand = params.expand || false;\n                        self.referer = el.data('referer');\n                        self.sortFeature = params.sortfeature;\n                        self.sortable = el.data('sortable');\n\n                        // Get all language strings.\n                        self.string = el.data('strings');\n                        self.forceCommenting = params.forcecommenting;\n                        self.canViewDeleted = params.canviewdeleted;\n                        self.isNoComment = params.isnocomment;\n\n                        self.initServerRender();\n                        self.initBindEditor();\n                        self.bindEvents();\n                        M.util.js_complete(t.ACTION_INIT);\n                    },\n\n                    /**\n                     * Init for server rendering.\n                     */\n                    initServerRender: function() {\n                        var self = this;\n                        self.changeWorkingState(true);\n                        $(t.SELECTOR.COMMENT_ITEM).each(function() {\n                            var id = $(this).data('id');\n                            var attrs = $(this).find(t.SELECTOR.SPAN_COMMENT_ID + id);\n                            var replies = [];\n                            if (self.expand) {\n                                replies = attrs.data('replies') || [];\n                            }\n                            var comment = {\n                                id: $(this).data('id'),\n                                deleted: attrs.data('deleted'),\n                                numberofreply: attrs.data('numberofreply'),\n                                expanded: self.expand,\n                                replies: replies,\n                                root: true\n                            };\n                            self.bindCommentEvent(comment);\n                        });\n\n                        // If expanded, current comment count is total comments + replies.\n                        var commentcount = self.expand ? self.countServerData.total : self.countServerData.count.commentcount;\n                        self.updateCommentCount(commentcount, self.countServerData.total);\n\n                        if (self.expand) {\n                            self.btnExpandAll.hide();\n                            self.btnCollapseAll.show();\n                        } else {\n                            self.btnExpandAll.show();\n                            self.btnCollapseAll.hide();\n                        }\n\n                        // Highlight.\n                        var query = window.location.search.substring(1);\n                        var getParams = self.parseQueryString(query);\n                        self.highlight = parseInt(getParams.highlight) || 0;\n                        // End set highlight.\n\n                        // Scroll to.\n                        if (self.highlight !== 0) {\n                            var target = $(t.SELECTOR.COMMENT_ID + self.highlight);\n                            if (target.length) {\n                                self.scrollToElement(target);\n                            }\n                        }\n\n                        self.changeWorkingState(false);\n                    },\n\n                    /**\n                     * Init comment editor.\n                     */\n                    initBindEditor: function() {\n                        var self = this;\n                        M.util.js_pending(t.ACTION_EDITOR_INIT);\n                        // Interval to init atto editor, there are time when Atto's Javascript slow to init the editor, so we\n                        // check interval here to make sure the Atto is init before calling our script.\n                        var interval = setInterval(function() {\n                            if (self.formSelector.find(t.SELECTOR.ATTO.CONTENT).length !== 0) {\n                                self.bindEditorEvent(self.formSelector);\n                                clearInterval(interval);\n                                M.util.js_complete(t.ACTION_EDITOR_INIT);\n                            }\n                        }, 500);\n                    },\n\n                    /**\n                     * Bind events: \"Expand all comments\", \"Collapse all comments\", \"Add Reply\".\n                     */\n                    bindEvents: function() {\n                        var self = this;\n                        // Bind event to \"Expand all comments\" button.\n                        self.btnExpandAll.click(function(e) {\n                            e.preventDefault();\n                            M.util.js_pending(t.ACTION_EXPAND_ALL);\n                            self.changeWorkingState(true);\n                            // Empty the replies section to append new response.\n                            self.containerSelector.empty();\n                            // Change button from expand to collapse collapse and disabled button since we don't want user to\n                            // press the button when javascript is appending item or ajax is working.\n                            self.btnExpandAll.hide();\n                            self.btnCollapseAll.show();\n                            self.loadingIcon.show();\n                            self.getComments(t.GET_ALL_VALUE).then(function(response) {\n                                // Calculate length to display count.\n                                var count = self.countCommentAndReplies(response.data);\n                                var total = count.total;\n                                self.updateCommentCount(total, response.total);\n                                self.renderComment(response.data, true);\n                                M.util.js_complete(t.ACTION_EXPAND_ALL);\n                                return true;\n                            }).fail(function(err) {\n                                M.util.js_complete(t.ACTION_EXPAND_ALL);\n                                self.showError(err.message);\n                                return false;\n                            });\n                        });\n\n                        // Bind event to \"Collapse all comments\" button.\n                        self.btnCollapseAll.click(function(e) {\n                            e.preventDefault();\n                            M.util.js_pending(t.ACTION_COLLAPSE_ALL);\n                            self.changeWorkingState(true);\n                            self.loadingIcon.show();\n                            self.btnCollapseAll.hide();\n                            self.btnExpandAll.show();\n                            self.containerSelector[0].innerHTML = '';\n                            self.getComments(self.numberToShow).then(function(response) {\n                                // Calculate length to display the post count.\n                                var count = self.countCommentAndReplies(response.data);\n                                var commentCount = count.commentCount;\n                                var deletedComments = count.totalDelete;\n                                // Only show expand button and count if comment existed.\n                                if (commentCount !== 0 || deletedComments !== 0) {\n                                    self.btnExpandAll.show();\n                                    self.updateCommentCount(commentCount, response.total);\n                                    self.renderComment(response.data, false);\n                                } else {\n                                    // No comment found hide loading icon.\n                                    self.loadingIcon.hide();\n                                    self.changeWorkingState(false);\n                                    self.updateCommentCount(0, 0);\n                                }\n                                M.util.js_complete(t.ACTION_COLLAPSE_ALL);\n                                return true;\n                            }).fail(function(err) {\n                                M.util.js_complete(t.ACTION_COLLAPSE_ALL);\n                                self.showError(err.message);\n                                return false;\n                            });\n                        });\n\n                        // Bind event to \"Add Reply\" button (Root comment).\n                        self.addComment.click(function(e) {\n                            e.preventDefault();\n                            M.util.js_pending(t.ACTION_CREATE);\n                            self.changeWorkingState(true);\n                            self.loadingIcon.show();\n                            // Hide error if exists.\n                            $(t.SELECTOR.COMMENT_ERROR).addClass('hide');\n                            // Hide no comment.\n                            $(t.SELECTOR.NO_COMMENT).hide();\n                            var rootId = t.ROOT_COMMENT_VALUE;\n                            var unique = self.questionId + '_' + rootId;\n                            var formSelector = self.formSelector;\n                            var formData = self.convertFormToJson(formSelector);\n                            // Check message field.\n                            if (formData['message[text]'].length === 0) {\n                                // Show message, atto won't auto show after second form is appended.\n                                var attoWrap = formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);\n                                if (attoWrap.length !== 0 && !attoWrap.hasClass('error')) {\n                                    attoWrap.addClass('error');\n                                    attoWrap.prepend('<span class=\"error\" tabindex=\"0\">' + self.string.required + '</span>');\n                                }\n                                M.util.js_complete(t.ACTION_CREATE);\n                                return false;\n                            }\n                            var params = {\n                                replyto: rootId,\n                                message: {\n                                    text: formData['message[text]'],\n                                    format: formData['message[format]'],\n                                },\n                            };\n                            self.createComment(params).then(function(response) {\n                                M.util.js_pending(t.ACTION_CLEAR_FORM);\n                                // Clear form in setTimeout to prevent require message still shown when reset on Firefox.\n                                setTimeout(function() {\n                                    // Clear form data.\n                                    formSelector.trigger('reset');\n                                    // Clear atto editor data.\n                                    if (!formSelector.find('#id_editor_question_' + unique + 'editable').is(':visible')) {\n                                        // HTML mode. Switch back to normal mode.\n                                        $(t.SELECTOR.ATTO_HTML_BUTTON).trigger('click');\n                                    }\n                                    formSelector.find('#id_editor_question_' + unique + 'editable').empty();\n                                    formSelector.find(t.SELECTOR.TEXTAREA).trigger('change');\n                                    M.util.js_complete(t.ACTION_CLEAR_FORM);\n                                });\n                                var data = self.convertForTemplate(response, true);\n                                // Disable reply button since content is now empty.\n                                formSelector.find(t.SELECTOR.SUBMIT_BUTTON).addClass('disabled');\n                                self.appendComment(data, self.elementSelector.find(t.SELECTOR.CONTAINER_REPLIES), false);\n                                M.util.js_complete(t.ACTION_CREATE);\n                                return true;\n                            }).fail(function(e) {\n                                self.handleFailWhenCreateComment(e, params);\n                                M.util.js_complete(t.ACTION_CREATE);\n                            });\n                            return true;\n                        });\n\n                        // Bind events filter sort.\n                        $(t.SELECTOR.COMMENT_FILTER_ITEM).on('click', function(e) {\n                            e.preventDefault();\n                            // Check if current state is working, return.\n                            if (self.workingState) {\n                                return;\n                            }\n\n                            var asc = self.string.sort.asc;\n                            var desc = self.string.sort.desc;\n\n                            var nameSelector = $(this).find(t.SELECTOR.COMMENT_FILTER_NAME);\n                            var iconSelector = $(this).find(t.SELECTOR.COMMENT_FILTER_TYPE);\n\n                            // Get sort type from data-type.\n                            var type = $(this).data('type');\n                            var orderBy = $(this).attr('data-order');\n                            var isCurrent = $(this).hasClass('current');\n                            var ascString = $(this).attr('data-asc-string');\n                            var descString = $(this).attr('data-desc-string');\n\n                            // Get current orderBy from data-order. If not current sort, don't change.\n                            // Then reverse it to opposite orderBy and call to API.\n                            // Example: current is desc, then we should call order by = asc to api.\n\n                            orderBy = orderBy === 'desc' ? 'asc' : 'desc';\n                            // Ok we attach that orderBy to current order by.\n                            $(this).attr('data-order', orderBy);\n\n                            if (!isCurrent) {\n                                $(this).addClass('current');\n                            }\n\n                            if (orderBy === 'desc') {\n                                nameSelector.attr('title', ascString);\n                                nameSelector.attr('alt', ascString);\n                                iconSelector.attr('title', desc);\n                                iconSelector.attr('alt', desc);\n                            } else {\n                                nameSelector.attr('title', descString);\n                                nameSelector.attr('alt', descString);\n                                iconSelector.attr('title', asc);\n                                iconSelector.attr('alt', asc);\n                            }\n\n                            // Note: new text is the opposite of current sort type (old type).\n\n                            // Reset all filter elements to its default.\n                            $(t.SELECTOR.COMMENT_FILTER_ITEM).not(this).each(function() {\n                                var each = $(this);\n                                var eachName = $(this).find(t.SELECTOR.COMMENT_FILTER_NAME);\n                                var eachType = $(this).find(t.SELECTOR.COMMENT_FILTER_TYPE);\n                                var defaultString = $(this).attr('data-asc-string');\n                                each.attr('data-order', 'desc');\n                                each.removeClass('filter-asc');\n                                each.removeClass('filter-desc');\n                                each.removeClass('current');\n                                eachName.attr('title', defaultString);\n                                eachName.attr('alt', defaultString);\n                                eachType.attr('title', asc);\n                                eachType.attr('alt', asc);\n                            });\n\n                            if (orderBy === 'desc') {\n                                $(this).removeClass('filter-asc');\n                                $(this).addClass('filter-desc');\n                            } else {\n                                $(this).removeClass('filter-desc');\n                                $(this).addClass('filter-asc');\n                            }\n\n                            // Build to sort type. Example: date_asc, date_desc.\n                            var sortType = type + '_' + orderBy;\n                            self.setSort(sortType);\n\n                            if (self.expand) {\n                                self.btnExpandAll.trigger('click');\n                            } else {\n                                self.btnCollapseAll.trigger('click');\n                            }\n                        });\n                    },\n\n                    /**\n                     * Get comments, numbertoshow = 0 will get all comment + replies.\n                     *\n                     * @param {Integer} numberToShow\n                     * @returns {Promise}\n                     */\n                    getComments: function(numberToShow) {\n                        var self = this;\n                        var params = self.getParamsBeforeCallApi({\n                            numbertoshow: numberToShow,\n                            sort: self.sortFeature\n                        });\n                        var promise = ajax.call([{\n                            methodname: t.ACTION_GET_ALL,\n                            args: params\n                        }]);\n                        return promise[0];\n                    },\n\n                    /**\n                     * Always map questionId and cmId to request before send.\n                     *\n                     * @param {Object} params\n                     * @returns {Object}\n                     */\n                    getParamsBeforeCallApi: function(params) {\n                        var self = this;\n                        params.questionid = self.questionId;\n                        params.cmid = self.cmId;\n                        return params;\n                    },\n\n                    /**\n                     * Show error which call showDialog().\n                     *\n                     * @param {String} message\n                     */\n                    showError: function(message) {\n                        var self = this;\n                        M.util.js_pending(t.ACTION_SHOW_ERROR);\n                        // Get error string for title.\n                        $.when(self.string.error).done(function(string) {\n                            self.showDialog(string, message);\n                            self.changeWorkingState(false);\n                            M.util.js_complete(t.ACTION_SHOW_ERROR);\n                        });\n                    },\n\n                    /**\n                     * Show the dialog with custom title and body.\n                     *\n                     * @param {String} title\n                     * @param {String} body\n                     */\n                    showDialog: function(title, body) {\n                        var self = this;\n                        var dialogue = self.dialogue;\n                        if (dialogue) {\n                            // This dialog is existed, only change title and body and then display.\n                            dialogue.title.html(title);\n                            dialogue.body.html(body);\n                            dialogue.show();\n                            return;\n                        }\n                        ModalFactory.create({\n                            type: ModalFactory.types.CANCEL,\n                            title: title,\n                            body: body\n                        }).done(function(modal) {\n                            dialogue = modal;\n                            // Display the dialogue.\n                            dialogue.show();\n                            dialogue.getRoot().on(ModalEvents.hidden, {}, function() {\n                                location.reload();\n                            });\n                        });\n                    },\n\n                    /**\n                     * Update the comments count on UI, of second parameter is not set then use the last value.\n                     *\n                     * @param {Integer|NULL} current\n                     * @param {Integer|NULL} total\n                     */\n                    updateCommentCount: function(current, total) {\n                        M.util.js_pending(t.ACTION_UPDATE_COMMENT_COUNT);\n                        var self = this;\n\n                        // If total parameter is not set, use the old value.\n                        if (total === -1) {\n                            total = self.lastTotal;\n                        } else {\n                            self.lastTotal = total;\n                        }\n\n                        // If current parameter is not set, use the old value.\n                        if (current === -1) {\n                            current = self.lastCurrentCount;\n                        } else {\n                            self.lastCurrentCount = current;\n                        }\n\n                        // Get the postof local string and display.\n                        var s = str.get_string('current_of_total', 'studentquiz', {\n                            current: current,\n                            total: total\n                        });\n\n                        var noCommentSelector = $(t.SELECTOR.NO_COMMENT);\n                        var filter = $(t.SELECTOR.COMMENT_FILTER);\n                        var emptyReplies = self.checkEmptyElement($(t.SELECTOR.CONTAINER_REPLIES));\n                        // Note: Admin will see deleted comments. Make sure replies container is empty.\n                        if (self.lastCurrentCount === 0 && emptyReplies && self.isNoComment) {\n                            $(t.SELECTOR.CONTAINER_REPLIES).hide();\n                            filter.hide();\n                            noCommentSelector.show();\n                        } else {\n                            $(t.SELECTOR.CONTAINER_REPLIES).show();\n                            noCommentSelector.hide();\n                            filter.show();\n                        }\n\n                        $.when(s).done(function(text) {\n                            self.elementSelector.find(t.SELECTOR.COMMENT_COUNT).text(text);\n                            M.util.js_complete(t.ACTION_UPDATE_COMMENT_COUNT);\n                        });\n                    },\n\n                    /**\n                     * Request template then append it into the page.\n                     *\n                     * @param {Array} comments\n                     * @param {Boolean} expanded\n                     * @returns {Boolean}\n                     */\n                    renderComment: function(comments, expanded) {\n                        var self = this;\n                        M.util.js_pending(t.ACTION_RENDER_COMMENT);\n                        comments = self.convertForTemplate(comments, expanded);\n                        Templates.render(t.TEMPLATE_COMMENTS, {\n                            comments: comments\n                        }).done(function(html) {\n                            // We render a lot of data, pure js here.\n                            self.containerSelector[0].innerHTML = html;\n                            // Turn off loading to show raw html first, then we bind events.\n                            self.loadingIcon.hide();\n                            // Loop to bind event.\n                            for (var i = 0; i < comments.length; i++) {\n                                self.bindCommentEvent(comments[i]);\n                            }\n                            self.changeWorkingState(false);\n                            M.util.js_complete(t.ACTION_RENDER_COMMENT);\n                        });\n                    },\n\n                    /**\n                     * Bind event to comment: report, reply, expand, collapse button.\n                     *\n                     * @param {Object} data\n                     */\n                    bindCommentEvent: function(data) {\n                        var self = this;\n                        // Loop comments and replies to get id and bind event for button inside it.\n                        var el = self.containerSelector.find(t.SELECTOR.COMMENT_ID + data.id);\n                        var i = 0;\n                        if (data.root && data.hasOwnProperty('replies')) {\n                            for (i; i < data.replies.length; i++) {\n                                var reply = data.replies[i];\n                                if (!reply.hasOwnProperty('expand')) {\n                                    reply.expand = true;\n                                }\n                                if (!reply.hasOwnProperty('root')) {\n                                    reply.root = false;\n                                }\n                                self.bindReplyEvent(reply, el);\n                            }\n                        }\n                        el.find(t.SELECTOR.BTN_DELETE).click(function(e) {\n                            self.bindDeleteEvent(data);\n                            e.preventDefault();\n                        });\n                        el.find(t.SELECTOR.BTN_REPLY).click(function(e) {\n                            e.preventDefault();\n                            self.getFragmentFormReplyEvent(data);\n                        });\n                        el.find(t.SELECTOR.EXPAND_LINK).click(function(e) {\n                            e.preventDefault();\n                            self.bindExpandEvent(data);\n                        });\n                        el.find(t.SELECTOR.COLLAPSE_LINK).click(function(e) {\n                            e.preventDefault();\n                            self.bindCollapseEvent(data);\n                        });\n                        el.find(t.SELECTOR.BTN_REPORT).click(function(e) {\n                            e.preventDefault();\n                            window.location = $(this).data('href');\n                        });\n                        el.find(t.SELECTOR.BTN_EDIT).click(function(e) {\n                            e.preventDefault();\n                            self.getFragmentEditFormEvent(data);\n                        });\n                    },\n\n                    /**\n                     * Bind event to reply's report and edit button.\n                     *\n                     * @param {Object} reply\n                     * @param {jQuery} el\n                     */\n                    bindReplyEvent: function(reply, el) {\n                        var self = this;\n                        var replySelector = el.find(t.SELECTOR.COMMENT_ID + reply.id);\n                        replySelector.find(t.SELECTOR.BTN_DELETE_REPLY).click(function(e) {\n                            self.bindDeleteEvent(reply);\n                            e.preventDefault();\n                        });\n                        replySelector.find(t.SELECTOR.BTN_REPORT).click(function(e) {\n                            e.preventDefault();\n                            window.location = $(this).data('href');\n                        });\n                        replySelector.find(t.SELECTOR.BTN_EDIT_REPLY).click(function(e) {\n                            e.preventDefault();\n                            self.getFragmentEditFormEvent(reply);\n                        });\n                    },\n\n                    /**\n                     * This function will disable/hide or enable/show when called depending on the working parameter.\n                     * Should call this function when we are going to perform the heavy operation like calling web service,\n                     * get render template, its will disabled button to prevent user from perform another action when page\n                     * is loading.\n                     * \"working\" is boolean parameter \"true\" will disable/hide \"false\" will enable/show.\n                     *\n                     * @param {Boolean} boolean\n                     */\n                    changeWorkingState: function(boolean) {\n                        var visibility = boolean ? 'hidden' : 'visible';\n                        var self = this;\n                        self.workingState = boolean;\n                        self.btnExpandAll.prop('disabled', boolean);\n                        self.btnCollapseAll.prop('disabled', boolean);\n                        self.elementSelector.find(t.SELECTOR.BTN_REPLY).prop('disabled', boolean);\n                        self.elementSelector.find(t.SELECTOR.BTN_DELETE).prop('disabled', boolean);\n                        self.elementSelector.find(t.SELECTOR.BTN_DELETE_REPLY).prop('disabled', boolean);\n                        self.elementSelector.find(t.SELECTOR.BTN_REPORT).prop('disabled', boolean);\n                        self.elementSelector.find(t.SELECTOR.EXPAND_LINK).css('visibility', visibility);\n                        self.elementSelector.find(t.SELECTOR.COLLAPSE_LINK).css('visibility', visibility);\n                        self.elementSelector.find(t.SELECTOR.BTN_EDIT).prop('disabled', boolean);\n                        self.elementSelector.find(t.SELECTOR.BTN_EDIT_REPLY).prop('disabled', boolean);\n                        if (self.deleteDialog) {\n                            self.deleteDialog.getFooter().find('button[data-action=\"yes\"]').prop('disabled', boolean);\n                        }\n                        if (boolean) {\n                            self.addComment.prop('disabled', boolean);\n                        } else {\n                            if (self.lastFocusElement) {\n                                self.lastFocusElement.focus();\n                                self.lastFocusElement = null;\n                            }\n                        }\n                    },\n\n                    /**\n                     * Count comments, deleted comments and replies.\n                     *\n                     * @param {*} data\n                     * @returns {{\n                     * deleteReplyCount: number,\n                     * total: number,\n                     * replyCount: number,\n                     * totalDelete: number,\n                     * deleteCommentCount: number,\n                     * commentCount: number\n                     * }}\n                     */\n                    countCommentAndReplies: function(data) {\n                        var commentCount = 0;\n                        var deleteCommentCount = 0;\n                        var replyCount = 0;\n                        var deleteReplyCount = 0;\n\n                        if (data.constructor !== Array) {\n                            data = [data];\n                        }\n\n                        for (var i = 0; i < data.length; i++) {\n                            var item = data[i];\n                            if (item.deletedtime == 0) {\n                                commentCount++;\n                            } else {\n                                deleteCommentCount++;\n                            }\n                            for (var j = 0; j < item.replies.length; j++) {\n                                var reply = item.replies[j];\n                                if (reply.deletedtime == 0) {\n                                    replyCount++;\n                                } else {\n                                    deleteReplyCount++;\n                                }\n                            }\n                        }\n                        return {\n                            total: commentCount + replyCount,\n                            totalDelete: deleteCommentCount + deleteReplyCount,\n                            commentCount: commentCount,\n                            deleteCommentCount: deleteCommentCount,\n                            replyCount: replyCount,\n                            deleteReplyCount: deleteReplyCount\n                        };\n                    },\n\n                    /**\n                     * Call web service to info of comment and its replies.\n                     *\n                     * @param {Integer} id\n                     * @returns {Promise}\n                     */\n                    expandComment: function(id) {\n                        var self = this;\n                        var params = self.getParamsBeforeCallApi({\n                            commentid: id\n                        });\n                        var promise = ajax.call([{\n                            methodname: t.ACTION_EXPAND,\n                            args: params\n                        }]);\n                        return promise[0];\n                    },\n\n                    /**\n                     * Expand event handler.\n                     *\n                     * @param {Object} item\n                     */\n                    bindExpandEvent: function(item) {\n                        var self = this;\n                        var itemSelector = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\n                        var key = t.ACTION_EXPAND;\n                        M.util.js_pending(key);\n                        self.changeWorkingState(true);\n                        // Clone loading icon selector then append into replies section.\n                        var loadingIcon = self.loadingIcon.clone().show();\n                        itemSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).append(loadingIcon);\n                        $(self).hide();\n                        // Call expand post web service to get replies.\n                        self.expandComment(item.id).then(function(response) {\n                            var convertedItem = self.convertForTemplate(response, true);\n\n                            // Count current reply displayed, because user can reply to this comment then press expanded.\n                            var currentDisplayComment = itemSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER_TO_ITEM).length;\n\n                            // Update count, handle the case when another user add post then current user expand.\n                            var total = self.countCommentAndReplies(convertedItem).replyCount;\n                            var newCount = self.lastCurrentCount + total - currentDisplayComment;\n                            var newTotalCount = self.lastTotal + (convertedItem.numberofreply - item.numberofreply);\n\n                            if (item.deleted && !convertedItem.deleted) {\n                                newCount++;\n                                newTotalCount++;\n                            }\n\n                            // Normal comment, then deleted by someone else.\n                            if (!item.deleted && convertedItem.deleted) {\n                                newCount--;\n                                newTotalCount--;\n                            }\n\n                            // If current show == total mean that all items is shown.\n                            if (newCount === newTotalCount) {\n                                self.btnExpandAll.hide();\n                                self.btnCollapseAll.show();\n                            }\n\n                            self.updateCommentCount(newCount, newTotalCount);\n\n                            return Templates.render(t.TEMPLATE_COMMENT, convertedItem).done(function(html) {\n                                var el = $(html);\n                                itemSelector.replaceWith(el);\n                                self.lastFocusElement = el.find(t.SELECTOR.COLLAPSE_LINK);\n                                self.bindCommentEvent(response);\n                                self.changeWorkingState(false);\n                                M.util.js_complete(key);\n                                return true;\n                            });\n                        }).fail(function(e) {\n                            M.util.js_complete(key);\n                            self.showError(e.message);\n                        });\n                    },\n\n                    /**\n                     * Collapse event handler.\n                     *\n                     * @param {Object} item\n                     */\n                    bindCollapseEvent: function(item) {\n                        var self = this;\n\n                        var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\n\n                        // Minus the comment currently show, exclude the deleted comment, update main count.\n                        // Using DOM to count the reply exclude the deleted, when user delete the reply belong to this comment,\n                        // current comment object don't know that, so we using DOM in this case.\n                        var commentCount = el.find(t.SELECTOR.COMMENT_REPLIES_TEXT).length;\n                        self.updateCommentCount(self.lastCurrentCount - commentCount, -1);\n                        // Assign back to comment object in case user then collapse the comment.\n                        item.numberofreply = commentCount;\n\n                        // Remove reply for this comment.\n                        el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).empty();\n\n                        // Replace comment content with short content.\n                        if (item.deleted) {\n                            el.find('.studentquiz-comment-delete-content').html(item.shortcontent);\n                        } else {\n                            el.find(t.SELECTOR.COMMENT_TEXT).html(item.shortcontent);\n                        }\n\n                        // Hide collapse and show expand icon.\n                        el.find(t.SELECTOR.COLLAPSE_LINK).hide();\n                        el.find(t.SELECTOR.EXPAND_LINK).show().focus();\n\n                        // Update state.\n                        item.expanded = false;\n                    },\n\n                    /**\n                     * Convert for template render.\n                     *\n                     * @param {*} data\n                     * @param {Boolean} expanded\n                     * @returns {*}\n                     */\n                    convertForTemplate: function(data, expanded) {\n                        var self = this;\n                        var single = false;\n                        if (data.constructor !== Array) {\n                            data = [data];\n                            single = true;\n                        }\n                        for (var i = 0; i < data.length; i++) {\n                            var item = data[i];\n                            item.expanded = expanded;\n                            item.canviewdeleted = self.canViewDeleted;\n                            if (!item.hasOwnProperty('replies')) {\n                                item.replies = [];\n                            }\n                            self.setHasComment(item.hascomment);\n                            item.highlight = item.id === self.highlight;\n                            if (self.referer && item.reportlink) {\n                                item.reportlink = self.buildRefererReportLink(item.reportlink, item.id);\n                            }\n                            // Only root comment has replies.\n                            if (item.root) {\n                                for (var j = 0; j < item.replies.length; j++) {\n                                    var reply = item.replies[j];\n                                    reply.expanded = true;\n                                    reply.canviewdeleted = self.canViewDeleted;\n                                    if (!reply.hasOwnProperty('replies')) {\n                                        reply.replies = [];\n                                    }\n                                    reply.highlight = reply.id === self.highlight;\n                                    if (self.referer && reply.reportlink) {\n                                        reply.reportlink = self.buildRefererReportLink(reply.reportlink, reply.id);\n                                    }\n                                }\n                            }\n                        }\n                        return single ? data[0] : data;\n                    },\n\n                    /**\n                     * Convert form data to Json require for web service.\n                     * Note: attempt.php had form already, we cannot have a form inside a form.\n                     *\n                     * @param {jQuery} form\n                     * @returns {Object}\n                     */\n                    convertFormToJson: function(form) {\n                        var data = {};\n                        form.find(\":input\").each(function() {\n                            var type = $(this).prop(\"type\");\n                            var name = $(this).attr('name');\n                            // Checked radios/checkboxes.\n                            if ((type === \"checkbox\" || type === \"radio\") && this.checked\n                                || (type !== \"button\" && type !== \"submit\")) {\n                                data[name] = $(this).val();\n                            }\n                        });\n                        return data;\n                    },\n\n                    /**\n                     * Call web services to create comment.\n                     *\n                     * @param {Object} data\n                     * @returns {Promise}\n                     */\n                    createComment: function(data) {\n                        var self = this;\n                        data = self.getParamsBeforeCallApi(data);\n                        var promise = ajax.call([{\n                            methodname: t.ACTION_CREATE,\n                            args: data\n                        }]);\n                        return promise[0];\n                    },\n\n                    /**\n                     * Append comment to the DOM, and call another function to bind the event into it.\n                     *\n                     * @param {Object} item\n                     * @param {jQuery} target\n                     * @param {Boolean} isReply\n                     */\n                    appendComment: function(item, target, isReply) {\n                        var self = this;\n                        M.util.js_pending(t.ACTION_APPEND_COMMENT);\n                        Templates.render(t.TEMPLATE_COMMENT, item).done(function(html) {\n                            var el = $(html);\n                            target.append(el);\n                            if (!self.lastCurrentCount) {\n                                // This is the first reply.\n                                $(t.SELECTOR.COMMENT_FILTER).removeClass(t.SELECTOR.COMMENT_FILTER_HIDE);\n                                self.updateCommentCount(1, 1);\n                                self.btnExpandAll.prop('disabled', true);\n                                self.btnExpandAll.hide();\n                                self.btnCollapseAll.prop('disabled', false);\n                                self.btnCollapseAll.show();\n                                self.expand = true;\n                                self.isNoComment = false;\n                            } else {\n                                self.updateCommentCount(self.lastCurrentCount + 1, self.lastTotal + 1);\n                            }\n                            if (isReply) {\n                                self.bindReplyEvent(item, el.parent());\n                            } else {\n                                self.bindCommentEvent(item);\n                            }\n                            self.loadingIcon.hide();\n                            self.changeWorkingState(false);\n                            M.util.js_complete(t.ACTION_APPEND_COMMENT);\n                        });\n                    },\n\n                    /*\n                    * Call web services to get the fragment form, append to the DOM then bind event.\n                    * */\n                    loadFragmentForm: function(fragmentForm, item) {\n                        var self = this;\n                        M.util.js_pending(t.ACTION_LOAD_FRAGMENT_FORM);\n                        var params = self.getParamsBeforeCallApi({\n                            replyto: item.id,\n                            cancelbutton: true,\n                            forcecommenting: self.forceCommenting\n                        });\n                        // Clear error message on the main form to prevent Atto editor from focusing to old message.\n                        var attoWrap = self.formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);\n                        if (attoWrap.length !== 0 && attoWrap.hasClass('error')) {\n                            attoWrap.removeClass('error');\n                            attoWrap.find('#id_error_message_5btext_5d').remove();\n                        }\n                        fragment.loadFragment(\n                            'mod_studentquiz',\n                            t.FRAGMENT_FORM_CALLBACK,\n                            self.contextId,\n                            params\n                        ).done(function(html, js) {\n                            Templates.replaceNodeContents(fragmentForm, html, js);\n                            // Focus form reply.\n                            var textFragmentFormId = '#id_editor_question_' + self.questionId + '_' + item.id + 'editable';\n                            fragmentForm.find(textFragmentFormId).focus();\n                            self.bindFragmentFormEvent(fragmentForm, item);\n                            M.util.js_complete(t.ACTION_LOAD_FRAGMENT_FORM);\n                        });\n                    },\n\n                    /*\n                    * Bind fragment form action button event like \"Reply\" or \"Save changes\".\n                    * */\n                    bindFragmentFormEvent: function(fragmentForm, item) {\n                        var self = this;\n                        var formFragmentSelector = fragmentForm.find(t.SELECTOR.COMMENT_AREA_FORM);\n                        fragmentForm.find(t.SELECTOR.SUBMIT_BUTTON).click(function(e) {\n                            e.preventDefault();\n                            self.changeWorkingState(true);\n                            var data = self.convertFormToJson(formFragmentSelector);\n                            // Check message field.\n                            if (data['message[text]'].length === 0) {\n                                return true; // Return true to trigger form validation and show error messages.\n                            }\n                            var clone = self.loadingIcon.clone().show();\n                            clone.appendTo(fragmentForm);\n                            formFragmentSelector.hide();\n                            self.createReplyComment(fragmentForm, item, formFragmentSelector, data);\n                            return true;\n                        });\n                        self.fragmentFormCancelEvent(formFragmentSelector, false);\n                        self.bindEditorEvent(fragmentForm);\n                    },\n\n                    /*\n                    * Call web services to create reply, update parent comment count, remove the fragment form.\n                    * */\n                    createReplyComment: function(replyContainer, item, formSelector, formData) {\n                        var self = this;\n                        var params = {\n                            replyto: item.id,\n                            message: {\n                                text: formData['message[text]'],\n                                format: formData['message[format]'],\n                            }\n                        };\n                        M.util.js_pending(t.ACTION_CREATE_REPLY);\n                        self.createComment(params).then(function(response) {\n                            // Hide error if exists.\n                            $(t.SELECTOR.COMMENT_ERROR).addClass('hide');\n                            var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\n                            var repliesEl = el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER);\n\n                            // There are case when user delete the reply then add reply then the numberofreply property is\n                            // not correct because this comment object does not know the child object is deleted, so we update\n                            // comment count using DOM.\n                            item.numberofreply++;\n\n                            var numReply = parseInt(el.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text()) + 1;\n\n                            // Update total count.\n                            el.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text(numReply);\n                            el.find(t.SELECTOR.COMMENT_COUNT_TEXT).html(\n                                numReply === 1 ? self.string.reply : self.string.replies\n                            );\n\n                            replyContainer.empty();\n                            var data = self.convertForTemplate(response, true);\n                            self.appendComment(data, repliesEl, true);\n                            M.util.js_complete(t.ACTION_CREATE_REPLY);\n                            return true;\n                        }).fail(function(e) {\n                            self.handleFailWhenCreateComment(e, params);\n                            M.util.js_complete(t.ACTION_CREATE_REPLY);\n                        });\n                    },\n\n                    handleFailWhenCreateComment: function(e, params) {\n                        var self = this;\n                        self.showError(e.message);\n                        // Remove the fragment form container.\n                        var fragmentFormSelector = t.SELECTOR.COMMENT_ID + params.replyto + ' ' + t.SELECTOR.FRAGMENT_FORM;\n                        self.elementSelector.find(fragmentFormSelector).empty();\n                    },\n\n                    /*\n                    * Begin to load the fragment form for reply.\n                    * */\n                    getFragmentFormReplyEvent: function(item) {\n                        var self = this;\n                        var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\n                        var fragmentForm = el.find(t.SELECTOR.FRAGMENT_FORM).first();\n                        var clone = self.loadingIcon.clone().show();\n                        fragmentForm.append(clone);\n                        self.loadFragmentForm(fragmentForm, item);\n                        self.changeWorkingState(true);\n                    },\n\n                    /**\n                     * Bind fragment form cancel button event.\n                     *\n                     * @param {jQuery} formSelector\n                     * @param {Boolean} isEdit\n                     */\n                    fragmentFormCancelEvent: function(formSelector, isEdit) {\n                        var self = this;\n                        formSelector.find('#id_cancel').click(function(e) {\n                            e.preventDefault();\n                            var commentSelector = formSelector.closest(t.SELECTOR.COMMENT_ITEM);\n                            if (isEdit) {\n                                self.lastFocusElement = commentSelector.find(t.SELECTOR.BTN_EDIT);\n                            } else {\n                                self.lastFocusElement = commentSelector.find(t.SELECTOR.BTN_REPLY);\n                            }\n                            self.changeWorkingState(false);\n                            formSelector.parent().empty();\n                        });\n                    },\n\n                    /**\n                     * Bind comment delete event.\n                     *\n                     * @param {Object} data\n                     */\n                    bindDeleteEvent: function(data) {\n                        var self = this;\n                        self.deleteTarget = data;\n                        if (self.deleteDialog) {\n                            // Use the rendered modal.\n                            self.deleteDialog.show();\n                        } else {\n                            // Disabled button to prevent user from double click on button while loading for template\n                            // for the first time.\n                            self.changeWorkingState(true);\n                            ModalFactory.create({\n                                type: ModalFactory.types.DEFAULT,\n                                title: self.string.deletecomment,\n                                body: self.string.confirmdeletecomment,\n                                footer: '<button class=\"btn btn-primary\" type=\"button\" data-action=\"yes\" title=\"' +\n                                    self.string.deletecomment + '\">' + self.string.deletetext + '</button>' +\n                                    '<button class=\"btn btn-secondary\" type=\"button\" data-action=\"no\" title=\"' +\n                                    self.string.cancel + '\">' +\n                                    self.string.cancel + '</button>'\n                            }).done(function(modal) {\n                                // Save modal for later.\n                                self.deleteDialog = modal;\n\n                                // Bind event for cancel button.\n                                modal.getFooter().find('button[data-action=\"no\"]').click(function(e) {\n                                    e.preventDefault();\n                                    modal.hide();\n                                });\n\n                                // Bind event for delete button.\n                                modal.getFooter().find('button[data-action=\"yes\"]').click(function(e) {\n                                    e.preventDefault();\n                                    M.util.js_pending(t.ACTION_DELETE);\n                                    self.changeWorkingState(true);\n                                    // Call web service to delete post.\n                                    self.deleteComment(self.deleteTarget.id).then(function(response) {\n                                        if (!response.success) {\n                                            self.showError(response.message);\n                                            return true;\n                                        }\n\n                                        var convertedCommentData = self.convertForTemplate(response.data,\n                                            self.deleteTarget.expanded);\n\n                                        // Delete success, begin to call template and render the page again.\n                                        var commentSelector = $(t.SELECTOR.COMMENT_ID + convertedCommentData.id);\n\n                                        var deletedComments = 1;\n\n                                        // Update global comment count.\n                                        self.updateCommentCount(\n                                            self.lastCurrentCount - deletedComments,\n                                            self.lastTotal - deletedComments\n                                        );\n\n                                        // Reply will always be expanded.\n                                        // Root comment deleted all replies => collapsed.\n                                        if (!convertedCommentData.root) {\n                                            convertedCommentData.expanded = true;\n                                        }\n\n                                        // Call template to render.\n                                        Templates.render(t.TEMPLATE_COMMENT, convertedCommentData).done(function(html) {\n                                            var el = $(html);\n\n                                            // Update the parent comment count if we delete reply before replace.\n                                            if (!convertedCommentData.root) {\n                                                var parentSelector = commentSelector.parent();\n                                                var parentCountSelector = parentSelector.closest(t.SELECTOR.COMMENT_ITEM)\n                                                    .find(t.SELECTOR.TOTAL_REPLY);\n                                                var countSelector = parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_NUMBER);\n                                                var newCount = parseInt(countSelector.text()) - 1;\n                                                parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text(newCount);\n                                                parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_TEXT).html(\n                                                    newCount === 1 ? self.string.reply : self.string.replies\n                                                );\n                                            }\n\n                                            // Clone replies and append because the replies will be replaced by template.\n                                            var oldReplies = commentSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER)\n                                                .clone(true);\n                                            commentSelector.replaceWith(el);\n                                            el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).replaceWith(oldReplies);\n\n                                            setTimeout(function() {\n                                                if (self.deleteTarget.root) {\n                                                    self.bindCommentEvent(data);\n                                                } else {\n                                                    self.bindReplyEvent(data, el.parent());\n                                                }\n                                                self.changeWorkingState(false);\n\n                                                M.util.js_complete(t.ACTION_DELETE);\n                                            }, 200);\n                                        });\n                                        modal.hide();\n                                        return true;\n                                    }).fail(function(err) {\n                                        self.showError(err.message);\n                                        return false;\n                                    });\n                                });\n\n                                // Focus back to delete button when user hide modal.\n                                modal.getRoot().on(ModalEvents.hidden, function() {\n                                    var el = $(t.SELECTOR.COMMENT_ID + self.deleteTarget.id);\n                                    // Focus on different element base on comment or reply.\n                                    if (self.deleteTarget.root) {\n                                        el.find(t.SELECTOR.BTN_DELETE).first().focus();\n                                    } else {\n                                        el.find(t.SELECTOR.BTN_DELETE_REPLY).first().focus();\n                                    }\n                                });\n\n                                // Enable button when modal is shown.\n                                modal.getRoot().on(ModalEvents.shown, function() {\n                                    self.changeWorkingState(false);\n                                });\n\n                                // Display the dialogue.\n                                modal.show();\n\n                                self.changeWorkingState(false);\n                            });\n                        }\n                    },\n\n\n                    /**\n                     * Delete comment API.\n                     *\n                     * @param {Integer} id\n                     * @returns {Promise}\n                     */\n                    deleteComment: function(id) {\n                        var self = this;\n                        var params = self.getParamsBeforeCallApi({\n                            commentid: id\n                        });\n                        var promise = ajax.call([{\n                            methodname: t.ACTION_DELETE,\n                            args: params\n                        }]);\n                        return promise[0];\n                    },\n\n                    /**\n                     * Bind Atto event.\n                     *\n                     * @param {jQuery} formSelector\n                     */\n                    bindEditorEvent: function(formSelector) {\n                        var self = this;\n                        M.util.js_pending('init_editor');\n\n                        self.triggerAttoNoContent(formSelector);\n\n                        formSelector.find(t.SELECTOR.ATTO.TOOLBAR).fadeIn();\n\n                        var key = 'text_change_' + Date.now();\n                        var textareaSelector = formSelector.find(t.SELECTOR.TEXTAREA);\n\n                        var attoEditableId = textareaSelector.attr('id') + 'editable';\n                        var attoEditable = document.getElementById(attoEditableId);\n                        var attoEditableEle = $('#' + attoEditableId);\n                        var observation = new MutationObserver(function(mutationsList) {\n                            mutationsList.forEach(function(mutation) {\n                                if (mutation.type === 'attributes' &&\n                                    (mutation.attributeName === 'style' || mutation.attributeName === 'hidden')) {\n                                    M.util.js_pending(key);\n                                    if (t.EMPTY_CONTENT.indexOf(attoEditableEle.html()) > -1 ||\n                                        attoEditableEle.text().trim().length < 1) {\n                                        self.triggerAttoNoContent(formSelector);\n                                    } else {\n                                        self.triggerAttoHasContent(formSelector);\n                                    }\n                                    M.util.js_complete(key);\n                                }\n                            });\n                        });\n                        observation.observe(attoEditable, {attributes: true, childList: true, subtree: true});\n                        textareaSelector.change(function() {\n                            M.util.js_pending(key);\n                            if (t.EMPTY_CONTENT.indexOf(attoEditableEle.html()) > -1 ||\n                                attoEditableEle.text().trim().length < 1) {\n                                self.triggerAttoNoContent(formSelector);\n                            } else {\n                                self.triggerAttoHasContent(formSelector);\n                            }\n                            M.util.js_complete(key);\n                        });\n                        M.util.js_complete('init_editor');\n\n                        // Check interval for 5s in case draft content show up.\n                        var interval = setInterval(function() {\n                            formSelector.find('textarea[id^=\"id_message\"]').trigger('change');\n                        }, 350);\n\n                        setTimeout(function() {\n                            clearInterval(interval);\n                        }, 5000);\n                    },\n\n                    /**\n                     * Check if element is empty.\n                     *\n                     * @param {jQuery} el - Element.\n                     * @returns {boolean}\n                     */\n                    checkEmptyElement: function(el) {\n                        return el.children().length === 0;\n                    },\n\n                    /**\n                     * Set user has commented.\n                     *\n                     * @param {integer} value\n                     */\n                    setHasComment: function(value) {\n                        var self = this;\n                        var container = $(t.SELECTOR.CONTAINER);\n                        var hasCommentClass = t.HAS_COMMENT_CLASS;\n                        if (!self.forceCommenting) {\n                            self.hasComment = true;\n                            container.addClass(hasCommentClass);\n                        } else {\n                            self.hasComment = value;\n                            if (self.hasComment) {\n                                container.addClass(hasCommentClass);\n                            } else {\n                                container.removeClass(hasCommentClass);\n                            }\n                        }\n                    },\n\n                    /**\n                     * Parse query string.\n                     *\n                     * @param {string} query\n                     * @return {string}\n                     */\n                    parseQueryString: function(query) {\n                        var vars = query.split(\"&\");\n                        var queryString = {};\n                        for (var i = 0; i < vars.length; i++) {\n                            var pair = vars[i].split(\"=\");\n                            var key = decodeURIComponent(pair[0]);\n                            var value = decodeURIComponent(pair[1]);\n                            // If first entry with this name.\n                            if (typeof queryString[key] === \"undefined\") {\n                                queryString[key] = decodeURIComponent(value);\n                                // If second entry with this name.\n                            } else if (typeof queryString[key] === \"string\") {\n                                queryString[key] = [queryString[key], decodeURIComponent(value)];\n                                // If third or later entry with this name.\n                            } else {\n                                queryString[key].push(decodeURIComponent(value));\n                            }\n                        }\n                        return queryString;\n                    },\n\n                    /**\n                     * Scroll to element.\n                     *\n                     * @param {jQuery} target\n                     * @param {Integer} speed\n                     */\n                    scrollToElement: function(target, speed) {\n                        if (!target.length) {\n                            return;\n                        }\n                        if (typeof speed === 'undefined') {\n                            speed = 1000;\n                        }\n                        var top = target.offset().top;\n                        $('html,body').animate({scrollTop: top}, speed);\n                    },\n\n                    /**\n                     * Build referer report link.\n                     *\n                     * @param {string} link\n                     * @param {Integer} id\n                     * @returns {string}\n                     */\n                    buildRefererReportLink: function(link, id) {\n                        var self = this;\n                        var referer = decodeURIComponent(self.referer);\n                        // Add highlight.\n                        link += '&referer=' + encodeURIComponent(referer + '&highlight=' + id);\n                        return link;\n                    },\n\n                    /**\n                     * Handle when Atto has content.\n                     *\n                     * @param {jQuery} formSelector\n                     */\n                    triggerAttoHasContent: function(formSelector) {\n                        var editorContentWrap = formSelector.find(t.SELECTOR.ATTO.CONTENT_WRAP);\n                        var submitBtn = formSelector.find(t.SELECTOR.SUBMIT_BUTTON);\n                        submitBtn.removeClass('disabled');\n                        submitBtn.prop('disabled', false);\n                        editorContentWrap.attr('data-placeholder', '');\n                        editorContentWrap.addClass(t.ATTO_CONTENT_TYPE.HAS_CONTENT);\n                        editorContentWrap.removeClass(t.ATTO_CONTENT_TYPE.NO_CONTENT);\n                    },\n\n                    /**\n                     * Handle when Atto has no content.\n                     *\n                     * @param {jQuery} formSelector\n                     */\n                    triggerAttoNoContent: function(formSelector) {\n                        var placeholder = formSelector.attr('data-textarea-placeholder');\n                        var editorContentWrap = formSelector.find(t.SELECTOR.ATTO.CONTENT_WRAP);\n                        var submitBtn = formSelector.find(t.SELECTOR.SUBMIT_BUTTON);\n                        submitBtn.addClass('disabled');\n                        submitBtn.prop('disabled', true);\n                        editorContentWrap.attr('data-placeholder', placeholder);\n                        editorContentWrap.addClass(t.ATTO_CONTENT_TYPE.NO_CONTENT);\n                        editorContentWrap.removeClass(t.ATTO_CONTENT_TYPE.HAS_CONTENT);\n                    },\n\n                    /**\n                     * Set sort depend on sortable array.\n                     *\n                     * @param {string} string\n                     */\n                    setSort: function(string) {\n                        var self = this;\n                        if ($.inArray(string, self.sortable) !== -1) {\n                            self.sortFeature = string;\n                        }\n                    },\n\n                    /**\n                     * Begin to load the fragment form for editing.\n                     *\n                     * @param {Object} item\n                     */\n                    getFragmentEditFormEvent: function(item) {\n                        var self = this;\n                        var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\n                        var fragmentForm = el.find(t.SELECTOR.FRAGMENT_FORM).first();\n                        var clone = self.loadingIcon.clone().show();\n                        fragmentForm.append(clone);\n                        self.loadFragmentEditForm(fragmentForm, item);\n                        self.changeWorkingState(true);\n                    },\n\n                    /**\n                     * Call web services to get the fragment edit form, append to the DOM then bind event.\n                     *\n                     * @param {jQuery} fragmentForm\n                     * @param {Object} item\n                     */\n                    loadFragmentEditForm: function(fragmentForm, item) {\n                        var self = this;\n                        M.util.js_pending(t.ACTION_LOAD_FRAGMENT_EDIT_FORM);\n                        var params = self.getParamsBeforeCallApi({\n                            cancelbutton: true,\n                            forcecommenting: self.forceCommenting,\n                            commentid: item.id\n                        });\n                        // Clear error message on the main form to prevent Atto editor from focusing to old message.\n                        var attoWrap = self.formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);\n                        if (attoWrap.length !== 0 && attoWrap.hasClass('error')) {\n                            attoWrap.removeClass('error');\n                            attoWrap.find('#id_error_message_5btext_5d').remove();\n                        }\n                        fragment.loadFragment(\n                            'mod_studentquiz',\n                            t.FRAGMENT_EDIT_FORM_CALLBACK,\n                            self.contextId,\n                            params\n                        ).done(function(html, js) {\n                            Templates.replaceNodeContents(fragmentForm, html, js);\n                            // Focus form.\n                            var textFragmentFormId = '#id_editor_question_' + self.questionId + '_' + item.id + 'editable';\n                            fragmentForm.find(textFragmentFormId).focus();\n                            self.bindFragmentEditFormEvent(fragmentForm, item);\n                            M.util.js_complete(t.ACTION_LOAD_FRAGMENT_EDIT_FORM);\n                        });\n                    },\n\n                    /**\n                     * Bind fragment edit form action button event.\n                     *\n                     * @param {jQuery} fragmentForm\n                     * @param {Object} item\n                     */\n                    bindFragmentEditFormEvent: function(fragmentForm, item) {\n                        var self = this;\n                        var formFragmentSelector = fragmentForm.find(t.SELECTOR.COMMENT_AREA_FORM);\n                        fragmentForm.find(t.SELECTOR.SUBMIT_BUTTON).click(function(e) {\n                            e.preventDefault();\n                            self.changeWorkingState(true);\n                            var data = self.convertFormToJson(formFragmentSelector);\n                            // Check message field.\n                            if (data['message[text]'].length === 0) {\n                                return true; // Return true to trigger form validation and show error messages.\n                            }\n                            var clone = self.loadingIcon.clone().show();\n                            clone.appendTo(fragmentForm);\n                            formFragmentSelector.hide();\n                            self.editCommentEvent(fragmentForm, item, formFragmentSelector, data);\n                            return true;\n                        });\n                        self.fragmentFormCancelEvent(formFragmentSelector, true);\n                        self.bindEditorEvent(fragmentForm);\n                    },\n\n                    /**\n                     * Edit comment event.\n                     *\n                     * @param {jQuery} container\n                     * @param {Object} item\n                     * @param {jQuery} formSelector\n                     * @param {Object} formData\n                     */\n                    editCommentEvent: function(container, item, formSelector, formData) {\n                        var self = this;\n                        M.util.js_pending(t.ACTION_EDIT);\n                        var params = {\n                            commentid: item.id,\n                            message: {\n                                text: formData['message[text]'],\n                                format: formData['message[format]'],\n                            }\n                        };\n                        self.editComment(params).then(function(response) {\n                            // Hide error if exists.\n                            $(t.SELECTOR.COMMENT_ERROR).addClass('hide');\n                            var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\n                            self.lastFocusElement = el.find(t.SELECTOR.BTN_EDIT);\n                            if (self.lastFocusElement.length === 0) {\n                                self.lastFocusElement = el.find(t.SELECTOR.BTN_EDIT_REPLY);\n                            }\n                            // Assign new content.\n                            item.shortcontent = response.shortcontent;\n                            Templates.render(t.TEMPLATE_COMMENT, response).done(function(html) {\n                                var el = $(html);\n                                var commentTextSelector = t.SELECTOR.COMMENT_ID + response.id + ' ' + t.SELECTOR.COMMENT_TEXT;\n                                $(commentTextSelector).parent().html(el.find(t.SELECTOR.COMMENT_TEXT).parent().html());\n                            });\n                            container.empty();\n                            self.changeWorkingState(false);\n                            M.util.js_complete(t.ACTION_EDIT);\n                            return true;\n                        }).fail(function(e) {\n                            self.handleFailWhenCreateComment(e, params);\n                            M.util.js_complete(t.ACTION_EDIT);\n                        });\n                    },\n\n                    /**\n                     * Call web services to edit comment.\n                     *\n                     * @param {Object} data\n                     * @returns {Promise}\n                     */\n                    editComment: function(data) {\n                        var self = this;\n                        data = self.getParamsBeforeCallApi(data);\n                        var promise = ajax.call([{\n                            methodname: t.ACTION_EDIT,\n                            args: data\n                        }]);\n                        return promise[0];\n                    }\n                };\n            },\n            generate: function(params) {\n                t.get().init(params);\n            }\n        };\n        return t;\n    });\n"],"file":"comment_area.min.js"}