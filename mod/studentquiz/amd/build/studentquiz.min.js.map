{"version":3,"sources":["../src/studentquiz.js"],"names":["define","$","initialise","forcerating","forcecommenting","ratingElements","off","on","addRating","e","keyCode","preventDefault","$that","afterquestion","length","filter","name","match","is","hasrated","hasClass","hascommented","removeClass","focus","submit","setFocus","document","ready","sortIcon","parent","selectAllQuestions","trigger","element","$element","rate","attr","$cmIdField","closest","find","cmid","post","M","cfg","wwwroot","save","questionid","sesskey","$ratingStars","children","addClass","each"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for save rating and save, remove and listing comments\n *\n * @package    mod_studentquiz\n * @copyright  2017 HSR (http://www.hsr.ch)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* jshint latedef:nofunc */\n\ndefine(['jquery'], function ($) {\n    return {\n        initialise: function (forcerating, forcecommenting) {\n\n            var ratingElements = $(\".studentquiz_behaviour .rate .rating .rateable\");\n            // Ajax request POST on CLICK for add rating.\n            ratingElements.off(\"click\").on(\"click\", function () {\n                addRating(this);\n            });\n            // Ajax request POST for add rating when \"Enter\" or \"Space\" is pressed.\n            ratingElements.on(\"keypress\", function (e) {\n                if (e.keyCode === 13 || e.keyCode === 32) {\n                    e.preventDefault();\n                    addRating(this);\n                }\n            });\n\n            // On CLICK check if student submitted result and has rated if not abort and show error for rating.\n            $('input[name=\"next\"], input[name=\"previous\"], input[name=\"finish\"]').off('click').on('click', function () {\n                var $that = $(this);\n\n                var afterquestion = !$('.im-controls input[type=\"submit\"]').length ||\n                    $('.im-controls input[type=\"submit\"]').filter(function () {\n                        return this.name.match(/^q.+-submit$/);\n                    }).is(':disabled');\n                if (afterquestion) {\n                    var hasrated = $('.rating span').hasClass('star');\n                    var hascommented = $('.studentquiz-comment-container').hasClass('has-comment');\n\n                    if (forcerating && !hasrated) {\n                        $('.studentquiz_behaviour > .rate > .rate_error').removeClass('hide');\n                    }\n                    if (forcecommenting && !hascommented) {\n                        $('.studentquiz_behaviour > .comments .comment-error').removeClass('hide');\n                    }\n\n                    // Set focus.\n                    if (forcerating && !hasrated) {\n                        // Set focus to the first star.\n                        $('.studentquiz_behaviour .rate .rating .rateable:first-child').focus();\n                    } else if (forcecommenting && !hascommented) {\n                        // Set focus to atto editor.\n                        $('.studentquiz_behaviour .comments .studentquiz-comment-container .editor_atto_content').focus();\n                    }\n\n                    if ((!forcerating || hasrated) && (!forcecommenting || hascommented)) {\n                        $that.submit();\n                        return true;\n                    }\n                    return false;\n                } else {\n                    $that.submit();\n                    return true;\n                }\n            });\n        },\n\n        // Set focus to sorted head of question table.\n        setFocus: function () {\n            $(document).ready(function () {\n                var sortIcon = $('#categoryquestions .iconsort');\n                if (sortIcon) {\n                    sortIcon.parent().focus();\n                }\n            });\n        },\n\n        // Select all questions.\n        selectAllQuestions: function () {\n            $(document).ready(function () {\n                $('#qbheadercheckbox').trigger('click');\n            });\n        }\n    };\n\n    /**\n     * Add rating to question.\n     *\n     * @param {DOM} element\n     */\n    function addRating(element) {\n        var $element = $(element);\n        var rate = $element.attr('data-rate');\n        var $that = $element;\n        var $cmIdField = $element.closest('form').find('.cmid_field');\n        var cmid = $cmIdField.attr('value');\n        $.post(M.cfg.wwwroot + '/mod/studentquiz/save.php',\n            { save: 'rate', cmid: cmid, questionid: $element.attr('data-questionid'), sesskey: M.cfg.sesskey, rate: rate },\n            function () {\n                var $ratingStars = $that.closest('.rating').children('span');\n                $ratingStars.removeClass('star');\n                $ratingStars.addClass('star-empty');\n                $ratingStars.each(function () {\n                    if ($(this).attr('data-rate') <= rate) {\n                        $(this).removeClass('star-empty');\n                        $(this).addClass('star');\n                    }\n                });\n                $('.studentquiz_behaviour > .rate > .rate_error').addClass('hide');\n            }\n        );\n    }\n});\n"],"file":"studentquiz.min.js"}